<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="author" content="Lucio Pentagna">
    <link rel="icon" href="media/favicon.ico">

    <title>Fab Academy 2017 - Lucio Pentagna</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="media/fabacademy.css" rel="stylesheet">
    
    <!-- 3D files viewer -->
    <script type="text/javascript" src="media/jsc3d_ie.min.js"></script>
	<script type="text/javascript" src="media/jsc3d.min.js"></script>
    <script type="text/javascript" src="media/jsc3d.webgl.js"></script>
    <script type="text/javascript" src="media/jsc3d.touch.js"></script>

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="bootstrap/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="bootstrap/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Load the menu file -->
    <script>
	function menu() {
					  $('#exercises').load("exercises-menu.html");
					  $('#project').load("project-menu.html");
					  $('#cclicense').load("license.html");
					  }
	</script>

  </head>

  <body onload="menu()">

    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Lucio Pentagna</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="about.html">About</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Exercises <span class="caret"></span></a>
              <ul id="exercises" class="dropdown-menu" role="menu">
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Final Project <span class="caret"></span></a>
              <ul id="project" class="dropdown-menu" role="menu">
              </ul>
            </li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

	<!-- Insert your content here below! -->
<h3>Week 4 - Make an in-circuit programmer by milling the PCB</h3>
        <h3>Description</h3>
    
<p>This week I will be making a ISP <a href="https://en.wikipedia.org/wiki/In-system_programming" >(In-system programming)</a> or in-circuit programmer.</p>

<p>I chose to do <a href="http://fab.cba.mit.edu/classes/863.16/doc/projects/ftsmin/index.html">Brian's ISP</a>. I chose it for its simplicity and cost as it is striped down to a bare minimum of components.</p>
        
<p class="pic"><img src="media/week4/image001.png"><legend>image from <a href="http://fab.cba.mit.edu/classes/863.16/doc/projects/ftsmin/index.html">Brian's ISP's</a> page</legend></p>
        
<p class="pic"><img src="media/week4/image003.png"><legend>image from <a href="http://fab.cba.mit.edu/classes/863.16/doc/projects/ftsmin/index.html">Brian's ISP's</a> page</legend></p>


<p>The process will be split in phases, Milling, Stuffing/Populating, De-buging, Programing:</p>

<h4>Milling</h4>
<p>On this phase I will be using the following:</p>

<p>_	Fab Modules <a href="http://fabmodules.org"></a></p>
<p>_	Mach3</p>
<p>_	The CNC</p>

<h4>Fab Modules</h4>

<p>-	I started by downloading the Traces (1000 dpi) and Outline Cutout (1000 dpi) of the circuit provided at Brian's tutorial.</p>

<p class="pic"><img src="media/week4/image005.png"><legend>image from <a href="http://fab.cba.mit.edu/classes/863.16/doc/projects/ftsmin/index.html">Brian's ISP's</a> page</legend></p>

<p class="pic"><img src="media/week4/image007.png"><legend>image from <a href="http://fab.cba.mit.edu/classes/863.16/doc/projects/ftsmin/index.html">Brian's ISP's</a> page</legend></p>

<h4>-	At Fab modules</h4>

<p>I selected the option "image (.png)"</p>
        
<p class="pic"><img src="media/week4/image009.png"><legend>image capture from my computer</legend></p>
        
<p>I choose the image file</p>
<p class="pic"><img src="media/week4/image011.png"><legend>image capture from my computer</legend></p>

<p>Once image is loaded I selected "output format" and then "G-codes (.nc)"</p>
        
<p class="pic"><img src="media/week4/image013.png"><legend>image capture from my computer</legend></p>

<p>On Process I selected "PCB traces (1/64)"</p>
        
<p class="pic"><img src="media/week4/image015.png"><legend>image capture from my computer</legend></p>

<p>Before calculating I changed the cut depth to 0.05, half of the default value as I was beeing a bit cautious on it.</p>
<p class="pic"><img src="media/week4/image017.png"><legend>image capture from my computer</legend></p>

<p>Then pressed calculate</p>

<p class="pic"><img src="media/week4/image019.png"><legend>image capture from my computer</legend></p>

<p>After calculation I proceed with a inspection of the toolpath to make sure that all traces were covered. By holding left mouse key I was able to move the image and with the wheel button I could zoom the image to better check the tool path.</p>
        
<p class="pic"><img src="media/week4/image021.png"><legend>image capture from my computer</legend></p>

<p>By holding right mouse key I was able to even see it with a different perspective.</p>
        
<p class="pic"><img src="media/week4/image023.png"><legend>image capture from my computer</legend></p>

<p>Last I saved the file for the milling process.</p>

<p class="pic"><img src="media/week4/image025.png"><legend>image capture from my computer</legend></p>

<p class="pic"><img src="media/week4/image027.png"><legend>image capture from my computer</legend></p>

<p>To outline I followed the same steps as before exept I chose to "PCB outline (1/32)" instead of traces.</p>

<p class="pic"><img src="media/week4/image029.png"><legend>image capture from my computer</legend></p>
        
<h4>2. Mach3</h4>

<p>I started the preparation of the cnc by milling a pocket the size of the blank PCB (76x50x1.5mm)</p>

<p class="pic"><img src="media/week4/image031.png"><legend>image capture from my computer</legend></p>

<p>Milling the pocket</p>

<p class="pic"><img src="media/week4/image033.png"><legend>photo of my cnc making a pocket for the blank pcb</legend></p>

<p>Finished pocket</p>

<p class="pic"><img src="media/week4/image035.png"><legend>photo of my cnc finishing pocket</legend></p>

<p>Gluing double face tape on the FR1 board
        </p>

<p class="pic"><img src="media/week4/image037.png"><legend>back of blank pcb</legend></p>

<p>The end result is this.</p>

<p class="pic"><img src="media/week4/image039.png"><legend>finishing the outside of the ISP</legend></p>
        
<p>Milling the cutout of one of the ISP's </p>

<p class="pic"><img src="media/week4/image041.png"><legend>image capture from my computer</legend></p>

<p>Removing the PCB from the pocket.</p>

<p class="pic"><img src="media/week4/image043.png"><legend>image capture from my computer</legend></p>
              
<p>I used a Xsato blade and sandpaper to remove shavings left from the milling process.</p>

<p class="pic"><img src="media/week4/image045.png"><legend>image capture from my computer</legend></p>

<p>Removed the double face tape from behind the pcb.</p>
        
<p class="pic"><img src="media/week4/image047.png"><legend> capture from my computer</legend></p>

<h4>3. Stuffing</h4>

<p>Basing on Brian's ISP's page tutorial I started by creating a spreadsheet with the components and its positions.</p>

<p class="pic"><img src="media/week4/image049.png"><legend>image capture from my computer</legend></p>
    
<p class="pic"><img src="media/week4/image051.png"><legend>image from Brian's ISP's page</legend></p>

BOM
<div class="table-responsive">    
<table class="table" border with="800">
 <tr>
  <td width="300">
  <p>Components</p>
  </td>
  <td width="100">
  <p>Location</p>
  </td>
  <td width="200">
  <p><span>Digikey</span>
  or Mouser</p>
  <p>Part number </p>
  </td>
  <td width="200">
  <p>Manufacture Part #</p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span><a href="http://www.atmel.com/devices/attiny45.aspx"><span>ATtiny45</span></a>
  or ATtiny85</p>
  </td>
  <td width="100">
  <p>U1</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/atmel/ATTINY45V-10SUR/ATTINY45V-10SURCT-ND/3789329"><span
  >ATTINY45V-10SU-ND</span></a></p>
  </td>
  <td width="200">
  <p>ATTINY45V-10SUR</p>
  </td>
 </tr>
 <tr >
  <td width="300">
  <p><span><span><span>- </span></span></span>2x
  1kΩ resistors</p>
  </td>
  <td width="100">
  <p>R1, R6</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/yageo/RC1206FR-071KL/311-1.00KFRCT-ND/731334"><span>311-1.00KFRCT-ND</span></a></p>
  </td>
  <td width="200">
  <p>RC1206FR-071KL </p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span>2x
  499Ω resistors</p>
  </td>
  <td width="100">
  <p>R2, R5</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/yageo/RC1206FR-07499RL/311-499FRCT-ND/731891"><span>311-499FRCT-ND</span></a></p>
  </td>
  <td width="200">
  <p>RC1206FR-07499RL </p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span>2x
  49Ω resistors</p>
  </td>
  <td width="100">
  <p>R3, R4</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/yageo/RC1206FR-0749R9L/311-49.9FRCT-ND/731889"><span>311-49.9FRCT-ND</span></a></p>
  </td>
  <td width="200">
  <p>RC1206FR-0749R9L</p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span>2x
  3.3v <span>zener</span> diodes</p>
  </td>
  <td width="100">
  <p>D1, D2</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/diodes-incorporated/BZT52C3V3-7-F/BZT52C3V3-FDICT-ND/717854"><span>BZT52C3V3-FDICT-ND</span></a></p>
  </td>
  <td width="200">
  <p>BZT52C3V3-7-F</p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span>1x
  red LED</p>
  </td>
  <td width="100">
  <p>D4</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/lite-on-inc/LTST-C150CKT/160-1167-1-ND/269239"><span>160-1167-1-ND</span></a></p>
  </td>
  <td width="200">
  <p>LTST-C150CKT</p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span>1x
  green LED</p>
  </td>
  <td width="100">
  <p>D3</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/lite-on-inc/LTST-C230TBKT/160-1889-1-ND/3306146"><span>160-1889-1-ND</span></a></p>
  </td>
  <td width="200">
  <p>LTST-C230TBKT</p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span>1x 100nF/0.1uF capacitor</p>
  </td>
  <td width="100">
  <p>C1</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.digikey.com/product-detail/en/kemet/C1206C104KARACTU/399-4674-1-ND/992199"><span>399-4674-1-ND</span></a></p>
  </td>
  <td width="200">
  <p>C1206C104KARACTU</p>
  </td>
 </tr>
 <tr>
  <td width="300">
  <p><span><span><span>- </span></span></span>1x
  2x3 pin header</p>
  </td>
  <td width="100">
  <p>ISP</p>
  </td>
  <td width="200">
  <p><a
  href="http://www.mouser.com/ProductDetail/Amphenol-FCI/95278-101A06LF/?qs=AwD%252bQufC0y6awc4Pvf%2Fc%252bg%3D%3D"><span>649-95278-101A06LF</span></a></p>
  </td>
  <td width="200">
  <p>71600-006LF</p>
  </td>
 </tr>
        </table>

<p>After that I proceed soldering all components in place.</p>


<p class="pic"><video controls><source src="media/week4/soldering.m4v">
            Your browser does not support HTML5 video.</video>

<h4>-3 Pre-Debugging</h4>
        
        <p>I started with a visual inspection.</p>

<p class="pic"><img src="media/week4/image053.png"><legend>photo of my semi-finished ISP</legend></p>
        
<p>OK I need to clean a bit more</p>
        
<p>That's when I realised I forgot to solder the jumper wire. That made me remove the shrink tube I had installed prior.</p>
        
<p class="pic"><img src="media/week4/image055.png"><legend>photo of my semi-finished ISP</legend></p>
        
<p>With the multimeter I looked for shorts and nothing was detected especially between Vcc and GND.</p>

<p>Overall the board seemed fine so I proceed with the programing. And now programing...</p>
        
<h4>Programming</h4>
        
<p>Under Ubuntu for Windows 10.
Started by installing the programing environment</p>

<p class="pic"><img src="media/week4/image057.png"><legend>capture of my computer screen</legend></p>

<p>With the prior command the programs got downloaded.</p>

<p class="pic"><img src="media/week4/image059.png"><legend>capture of my computer screen</legend></p>

<p>I then downloaded the firmware source  to a directory. Following that I run the command <pre class="prettyprint linenums">make</pre>
</p>
        
<p class="pic"><img src="media/week4/image061.png"><legend>capture of my computer screen</legend></p>
        
<p>Using Sublime-text I edited the makefile file and replaced the entry "PROGRAMMER ?= usbtiny" with "PROGRAMMER ?= usbasp".</p>
        
<p class="pic"><img src="media/week4/image063.png"><legend>capture of my computer screen</legend></p>

<p>I then run <pre class="prettyprint linenums">make flash</pre></p>

<p class="pic"><img src="media/week4/image065.png"><legend>capture of my computer screen</legend></p>
        
<p>But not success. So I run <pre class="prettyprint linenums">lsusb</pre> and I get a message “unable to initialize libusb: -99</p>

<p class="pic"><img src="media/week4/image067.png"><legend>capture of my computer screen</legend></p>

<p>After a quick search on stackoverflow I find out there is no support for usb under windows 10 ubuntu shell yet! Argh!</p>
        
<p class="pic"><img src="media/week4/image069.png"><legend>capture of my computer screen on <a href="http://stackoverflow.com/questions/38954691/is-usb-supported-on-bash-on-ubuntu-on-windows-10">stackoverflow</a> </legend></p>

<p>Then I gave up on Ubuntu bash for windows 10 and run a copy of Ubuntu under VMware player.
At ubuntu I run:</p>
        
<pre class="prettyprint linenums">sudo apt install avrdude gcc-avr avr-libc make</pre>

<p class="pic"><img src="media/week4/image071.png"><legend>capture of my computer screen</legend></p>


<p>This time after running lsusb I can see that device is present.</p>

<p>I run </p>

<pre class="prettyprint linenums">make</pre> 

<p>in order to compile the firmware.</p>
        
<p class="pic"><img src="media/week4/image073.png"><legend>capture of my computer screen</legend></p>


<p>I then run</p> 
<pre class="prettyprint linenums">make flash
</pre> 
<p>But again I got an error message.
</p>

<p>I end up finding out that my ISP has to have a jumper installed in order to program the Attiny45. So I do it! </p>

<p>And it works!</p>

<p class="pic"><img src="media/week4/image075.png"><legend>capture of my computer screen</legend></p>

<p>Next I run <pre class="prettyprint linenums">make fuses</pre></p>
        
<p class="pic"><img src="media/week4/image077.png"><legend>capture of my computer screen</legend></p>

<p>After having the firmware uploaded and fuses burnt my new ASP would not be recognised.</p>
<p>So back to debugging…</p>
<p>I end up measuring each resistor value, and replacing the attiny with a new one. With a multimeter I found out that the R1 1K resistor was not working, replaced and voila. Board detected!!! Oh also I decided to install a usb connector I cutted from an old cable and after some washing that's how it looks.</p>

<p class="pic"><img src="media/week4/image079.png"><legend>photo of my tiny ISP without cover</legend></p>
<p class="pic"><img src="media/week4/ispworking.jpg"><legend>photo of my tiny ISP with cover and programing</legend></p>
<p>Final command make rstdisbl and this tiny can't be programed again.</p>

<p class="pic"><img src="media/week4/image081.png"><legend>capture of my computer screen</legend></p>

<p>It worked now I remove jumper!</p>

<p class="pic"><img src="media/week4/image083.png"><legend>capture of my computer screen</legend></p>

<p>It works!</p>

<h4>-4 Final Test</h4>

<p>Loading the driver on windows I use the tool "Zadig_2.2.exe"</p>

<p class="pic"><img src="media/week4/image085.png"><legend>capture of my computer screen</legend></p>

<p>After the driver installation I tested under windows the burning of my 3D printer board's firmware.</p>

<p class="pic"><video controls><source src="media/week4/ispworks.m4v">
    Your browser does not support HTML5 video.</video>
    
<p class="pic"><img src="media/week4/image087.png"><legend>capture of my computer screen</legend></p>

<p>All working!</p>
        
    <!-- End of your content -->

</div> <!-- /container -->

	<!-- footer -->
    
    <footer id="footer">
        <p id="cclicense">
                </p>
        <p class="license">
        Theme: <a href="https://github.com/openp2pdesign/FabAcademy_Template">Fab Academy Template</a> by <a href="http://openp2pdesign.org">Massimo Menichinelli</a> <br>
        Based on <a href="http://getbootstrap.com/">Twitter Bootstrap</a>+<a href="http://jquery.com/">JQuery</a>+<a href="https://code.google.com/p/google-code-prettify/">google-code-prettify</a>+<a href="http://jmblog.github.io/color-themes-for-google-code-prettify/github/">GitHub theme for google-code-prettify</a>+<a href="https://code.google.com/p/jsc3d/">JSC3D</a>+<a href="https://github.com/thegrubbsian/jquery.ganttView">jquery.ganttView</a>.
        </p>
    </footer>
    

	<!-- Do not touch this! -->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="media/jquery-1.9.1.min.js"></script>
    
    <!-- Syntax Highlighter -->
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js">
    </script>
    <!-- From https://github.com/jmblog/color-themes-for-google-code-prettify -->
    <link href="media/github.css" type="text/css" rel="stylesheet">
	<script type="text/javascript">
	  !function ($) {
		$(function(){
		  window.prettyPrint && prettyPrint()   
		})
	  }(window.jQuery)
	</script>
	
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="bootstrap/js/ie10-viewport-bug-workaround.js"></script>

  </body>
</html>
